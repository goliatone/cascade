manifest_version: 1
module:
  module: github.com/goliatone/cascade
  module_path: .
  branch: main
  tests:
    - cmd: ["task", "test:module"]
      dir: ""
  extra_commands:
    - cmd: ["task", "lint:module"]
      dir: ""
  labels: ["module:self"]
  env:
    GOFLAGS: "-count=1"
  notifications:
    slack_channel: "#cascade-module"
  pr:
    title: "chore: cascade module update"
  timeout: 10m
defaults:
  branch: main
  tests:
    - cmd: ["go", "test", "./...", "-race"]
      dir: ""
  extra_commands:
    - cmd: ["task", "lint"]
      dir: ""
  labels: ["automation:cascade"]
  commit_template: "chore(deps): bump {{ module }} to {{ version }}"
  notifications:
    slack_channel: "#releases"
  pr:
    title: "chore: update dependencies"
    body_template: "default.pr.tpl.md"
    reviewers: ["octocat"]
modules:
  - name: go-errors
    module: github.com/goliatone/go-errors
    repo: goliatone/go-errors
    release_artifact: release.json
    dependents:
      - repo: goliatone/go-logger
        module: github.com/goliatone/go-logger
        module_path: .
        branch: main
        canary: true
        tests:
          - cmd: ["task", "test"]
            dir: ""
        extra_commands:
          - cmd: ["task", "lint"]
            dir: ""
        labels: ["package:go-logger"]
        pr:
          title: "chore: update go-logger deps"
          body_template: "logger.pr.tpl.md"
      - repo: goliatone/go-router
        module: github.com/goliatone/go-router
        module_path: .
        branch: develop
        tests:
          - cmd: ["go", "test", "./..."]
            dir: "router"
  - name: go-repository-bun
    module: github.com/goliatone/go-repository-bun
    repo: goliatone/go-repository-bun
    release_artifact: release.json
    dependents:
      - repo: goliatone/go-auth
        module: github.com/goliatone/go-auth
        module_path: .
        branch: main
        tests:
          - cmd: ["task", "test:integration"]
            dir: ""
        extra_commands:
          - cmd: ["go", "run", "./cmd/db/migrate", "--dry-run"]
            dir: ""
        labels: ["package:go-auth"]
        notifications:
          slack_channel: "#go-auth-releases"
dependents:
  github.com/goliatone/go-errors:
    branch: release
    tests:
      - cmd: ["task", "dependent:test"]
        dir: ""
    extra_commands:
      - cmd: ["task", "dependent:lint"]
        dir: ""
    labels: ["module:go-errors"]
    notifications:
      slack_channel: "#deps"
    pr:
      title: "deps: update go-errors"
    env:
      FOO: "bar"
    timeout: 5m
    canary: true
